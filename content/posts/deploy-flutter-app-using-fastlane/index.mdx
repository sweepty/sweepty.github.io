---
title:  "Fastlaneìœ¼ë¡œ Flutter ë¹Œë“œ ë° ë°°í¬ ìë™í™” í™˜ê²½ êµ¬ì¶•í•˜ê¸°"
category: iOS
tags:
  - Fastlane
  - iOS
  - Flutter
slug: "/deploy-flutter-app-using-fastlane"
date: 2020-09-13
description: Fastlaneì„ Flutterì—ì„œë„ ì™„ë²½í•˜ê²Œ ì ìš©í•´ë³´ì
---

### ğŸ¤” Flutterì—ì„œ TestFlightì— ë°°í¬í•˜ë ¤ë©´?

1. `$ flutter build ios` ë¡œ ë¦´ë¦¬ì¦ˆ ë¹Œë“œë¥¼ ìƒì„±í•œë‹¤.
2. versionê³¼ build numberë¥¼ ì˜¬ë¦°ë‹¤.
3. Xcodeì—ì„œ Archive. (ê¸°ë‹¤ë¦¼ í•„ìš”...)
4. AppStore Connectì— Distribute. (ê¸°ë‹¤ë¦¼ í•„ìš”...)
5. TestFlightì— ë¹Œë“œê°€ ì˜¬ë¼ê°€ë©´ ìŠ¬ë™ìœ¼ë¡œ ê³µìœ í•œë‹¤.

**ê¸°ì¡´ ë°°í¬ ë°©ì‹ì€ ì˜¤ë˜ ê¸°ë‹¤ë ¤ì•¼í•˜ê³  ë„ˆë¬´ ê·€ì°®ë‹¤!!** ğŸ˜«

í•˜ë£¨ì— ëª‡ë²ˆì”© ë°°í¬ë¥¼ í•˜ë‹¤ë³´ë‹ˆ ë¹Œë“œì™€ ë°°í¬ ìë™í™” í•„ìš”ì„±ì´ ì ˆì‹¤í•´ì ¸ì„œ Fastlaneì„ ë„ì…í•˜ê¸°ë¡œ ê²°ì‹¬í–ˆë‹¤.

[Fastlane](https://docs.fastlane.tools/)ì€ iOS Appê³¼ Android App ë¹Œë“œì™€ ë°°í¬ë¥¼ ìë™í™” ì‹œì¼œì£¼ëŠ” ì˜¤í”ˆì†ŒìŠ¤ íˆ´ì´ë‹¤.

ê¸°ë³¸ì ì¸ Fastlane ì‚¬ìš©ë°©ë²•ì€ [Flutter ê³µì‹ fastlane ë¬¸ì„œ](https://flutter.dev/docs/deployment/cd)ì— ì •ë¦¬ë˜ì–´ ìˆë‹¤.

ë‚˜ì˜ ëª©í‘œëŠ” ë‹¤ìŒ 2ê°€ì§€ì˜€ë‹¤.

1. ê°œë°œ ìš´ì˜ í™˜ê²½ ë³€ìˆ˜ ì˜ ê´€ë¦¬í•˜ê¸°(Production, Staging and etc...)
2. ë¦´ë¦¬ì¦ˆ ë¹Œë“œë¥¼ ëœ¨ëŠ” ê²ƒ(flutter build ios)ê¹Œì§€ ìë™í™”ì— í¬í•¨í•˜ê¸°


### ğŸŒ í™˜ê²½ ë³€ìˆ˜ ì„¤ì •í•˜ê¸°

fastlaneì€ envíŒŒì¼ë¡œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë‹¤.

`fastlane` ë””ë ‰í† ë¦¬ì— ìˆëŠ” `.env` íŒŒì¼ì—ëŠ” ê³µí†µìœ¼ë¡œ ì‚¬ìš©í•˜ëŠ” ë¶€ë¶„ì„ ëª…ì‹œí•´ì£¼ë©´ ëœë‹¤.

.env

```
SLACK_URL="your-slack-webhook-url"
APPLE_ID="your-apple-id"
```

ìš°ë¦¬ íšŒì‚¬ì˜ ê²½ìš°ì—ëŠ” ê°ìì˜ ì• í”Œ ê³„ì •ì„ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— Apple Idë„  env íŒŒì¼ì—ì„œ ë”°ë¡œ ê´€ë¦¬í•˜ë„ë¡ í–ˆë‹¤.

ìš´ì˜ í™˜ê²½ íŒŒì¼ì€ Productionìš© `.env.live` ì™€ Stagingìš© `.env.testbed`ë¥¼ ìƒì„±í–ˆë‹¤.

1. slack ë©”ì„¸ì§€ë¥¼ ë³´ë‚¼ ë•Œ ì‚¬ìš©í•  ì´ëª¨ì§€
2. í™˜ê²½ ë³€ìˆ˜ ì´ë¦„
3. ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ì‹œì— ì‚¬ìš©í•  main ê²½ë¡œ

.env.live

```
ENV_EMOJI="ğŸ”µ"
ENV="Live"
MAIN_TARGET="lib/main_live.dart"
```

.env.testbed

```
ENV_EMOJI="ğŸŸ "
ENV="Testbed"
MAIN_TARGET="lib/main_testbed.dart"
```

> í™˜ê²½ ë³€ìˆ˜ë¥¼ ë¶ˆëŸ¬ì˜¤ë ¤ë©´ `ENV["ë³€ìˆ˜ëª…"]` ìœ¼ë¡œ ë¶ˆëŸ¬ì˜¤ë©´ ëœë‹¤.
>
> ex)  `ENV["ENV_EMOJI"]` ,  `ENV["MAIN_TARGET"]` 


ì•„ë˜ëŠ” í™˜ê²½ë³€ìˆ˜ì— ë§ê²Œ TestFlight ë°°í¬ë¥¼ í•˜ëŠ” `beta` laneì´ë‹¤.

```
desc "Push a new beta build to TestFlight"
  lane :beta do
    # Fetching the latest build number from TestFlight
    increment_build_number(
      build_number: latest_testflight_build_number + 1,
	xcodeproj: "Runner.xcodeproj"
    )

    # ë°°í¬ ì‹œì‘ ì‹œ ìŠ¬ë™ ë©”ì„¸ì§€ ë³´ë‚´ê¸°
    send_slack_message(msg: "ğŸ’« TestFlight ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")

    # Flutter build iOS - ì„¤ì •í•œ í™˜ê²½ë³€ìˆ˜ì— ë§ëŠ” mainìœ¼ë¡œ ë¹Œë“œ
    # (ì´ laneì— ëŒ€í•œ ì„¤ëª…ì€ ì•„ë˜ì— ìˆìŠµë‹ˆë‹¤.)
    flutter_build_ios

    # Build app
    build_app(workspace: "Runner.xcworkspace", scheme: "Runner")

    # Upload to testflight
    upload_to_testflight

    # Send slack message
    send_slack_message(msg: "ğŸš€ Successfully distributed a new beta build âœ¨")
  end  

  # Send slack message
  lane :send_slack_message do |options|
    version = get_version_number(xcodeproj: "Runner.xcodeproj")
    build_number = get_build_number(xcodeproj: "Runner.xcodeproj")
    slack(
      message: options[:msg],
      payload: {
        "Version" => :version,
        "Build" => build_number,
        "Environment" => ENV[ENV_EMOJI]+ " "+ ENV['ENV']
      },
    )
  end
```

fastlane ì»¤ë§¨ë“œ ì‹¤í–‰ ì‹œì— `--env` ì˜µì…˜ì„ ì‚¬ìš©í•˜ë©´ í™˜ê²½ ë³€ìˆ˜ë¥¼ ì„ íƒí•  ìˆ˜ ìˆë‹¤.

```bash
$ fastlane [lane ì´ë¦„] --env [í™˜ê²½ë³€ìˆ˜ íŒŒì¼ ì´ë¦„]
$ fastlane beta --env live
$ fastlane beta --env testbed
```

### ğŸš€ ìë™í™”ì— ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ìƒì„± ì‘ì—… í¬í•¨í•˜ê¸°

ì™€ ìë™í™” í™˜ê²½ ë‹¤ ë§Œë“¤ì—ˆë‹¤!!ğŸ˜†

ë¼ê³  ìƒê°í–ˆì§€ë§Œ.. 
ìš°ë¦¬ëŠ” Flutterë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸° ë•Œë¬¸ì— ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ìƒì„± ë‹¨ê³„ê¹Œì§€ í¬í•¨í•´ì„œ ì•„ë˜ì™€ ê°™ì€ ì»¤ë§¨ë“œ ë¼ì¸ì„ ì‹¤í–‰í•´ì•¼í–ˆë‹¤.

1. `$ flutter build ios -t lib/main_live.dart`  ë¡œ ë¦´ë¦¬ì¦ˆ ë¹Œë“œ ìƒì„±
2. `$ cd ios`
3. `$ fastlane beta --live`

ì´ëŸ¬ë©´ ìë™í™”ë¥¼ í•œ ì˜ë¯¸ê°€ ë¬´ìƒ‰í•´ì§€ê¸° ë•Œë¬¸ì— ì´ ë¶€ë¶„ë„ fastlane ì‹¤í–‰ ì‹œì— í¬í•¨í•˜ê¸°ë¡œ í–ˆë‹¤.

FastFileì—ì„œ [sh](https://docs.fastlane.tools/actions/sh/)ë¥¼ ì‚¬ìš©í•˜ë©´ shell commandë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë‹¤.

ì•„ë˜ëŠ” flutter build iosë¥¼ ì‹¤í–‰í•˜ëŠ” laneì´ë‹¤. 

```
default_platform(:ios)

platform :ios do
  # Flutter build iOS
  lane :flutter_build_ios do
    # ios ë””ë ‰í† ë¦¬ì—ì„œ cd ..ë¡œ í”„ë¡œì íŠ¸ root ê²½ë¡œë¡œ ì´ë™í•œë‹¤.
    sh("cd", "..")
    
    # flutter clean ì‹¤í–‰
    sh("flutter", "clean")
    
    # flutter build iosë¡œ ë¦´ë¦¬ì¦ˆ ë¹Œë“œë¥¼ ìƒì„±í•œë‹¤.
    # -tëŠ” main ê²½ë¡œë¥¼ ì§€ì •í•´ì£¼ëŠ” ì˜µì…˜ì´ë‹¤.
    # ì—¬ê¸°ì„œ ENV['MAIN_TARGET']ì€ "lib/main_live.dart"ì´ë‹¤.
    sh("flutter", "build", "ios", "--no-codesign", "-t", ENV['MAIN_TARGET'])
  end
end
```



### ê²°ê³¼

FastFile ì „ì²´ ì½”ë“œ

```
# This file contains the fastlane.tools configuration
# You can find the documentation at https://docs.fastlane.tools
#
# For a list of all available actions, check out
#
#     https://docs.fastlane.tools/actions
#
# For a list of all available plugins, check out
#
#     https://docs.fastlane.tools/plugins/available-plugins
#

# Uncomment the line if you want fastlane to automatically update itself
# update_fastlane

default_platform(:ios)

platform :ios do

  desc "Push a new beta build to TestFlight"
  lane :beta do
  
    # Fetching the latest build number from TestFlight
    increment_build_number(
      build_number: latest_testflight_build_number + 1,
	xcodeproj: "Runner.xcodeproj"
    )

    send_slack_message(msg: "ğŸ’« TestFlight ë°°í¬ë¥¼ ì‹œì‘í•©ë‹ˆë‹¤.")

    # Flutter build iOS
    flutter_build_ios

    # Add badge to app icon (only testbed)
    add_badge_to_icon

    # Build app
    build_app(workspace: "Runner.xcworkspace", scheme: "Runner")

    # Upload to testflight
    upload_to_testflight

    # Send slack message
    send_slack_message(msg: "ğŸš€ Successfully distributed a new beta build âœ¨")
  end  

  # Send slack message
  lane :send_slack_message do |options|
    version = get_version_number(xcodeproj: "Runner.xcodeproj")
    build_number = get_build_number(xcodeproj: "Runner.xcodeproj")
    slack(
      message: options[:msg],
      payload: {
        "Version" => :version,
        "Build" => build_number,
        "Environment" => ENV[ENV_EMOJI]+ " "+ ENV['ENV']
      },
    )
  end

  # Flutter build iOS
  lane :flutter_build_ios do
    sh("cd", "..")

    puts "Flutter clean"
    sh("flutter", "clean")

    puts "Flutter build iOS"
    sh("flutter", "build", "ios", "--no-codesign", "-t", ENV['MAIN_TARGET'])
  end
  
  # Add badge to app icon
  private_lane :add_badge_to_icon do
    if ENV["ENV"] == "Testbed"
      add_badge(alpha: true, dark: true)
    end
  end
  
  # Error handling
  error do |lane, exception|
    slack(
      message: "ğŸ˜± "+exception.message,
      success: false
    )
  end
end

```

ì´ì œ command line í•œ ì¤„ë§Œ ì‹¤í–‰í•˜ë©´ ë°°í¬ì— í•„ìš”í•œ ëª¨ë“  ê³¼ì •ì„ ì‹¤í–‰í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆë‹¤!

```bash
$ fastlane beta --env live
$ fastlane beta --env testbed
```


testbedì¸ ê²½ìš°ì—ëŠ” [badge](https://docs.fastlane.tools/actions/badge/)ë¡œ 
ì•± ì•„ì´ì½˜ì— alpha ë±ƒì§€ë¥¼ ë‹¬ì•„ì£¼ë„ë¡í–ˆë‹¤.

### ğŸ¥³ Fastlaneìœ¼ë¡œ ë°°í¬ ì„±ê³µ!
![succes slack message](./deploy-success-slack-message.png)

TestFlightì— ë°°í¬ê°€ ë˜ë©´ ì´ë ‡ê²Œ ìŠ¬ë™ ë©”ì„¸ì§€ê°€ ë‚ ì•„ì˜¨ë‹¤! 

ê·¸ë™ì•ˆ ê°œë°œ ìš´ì˜ í™˜ê²½ì— ë”°ë¥¸ ë‹¤ì¤‘ ë¹Œë“œì™€ flutter buildì— ê³ í†µë°›ì•˜ì—ˆëŠ”ë° ê´‘ëª…ì„ ì°¾ì„ ìˆ˜ ìˆì—ˆë‹¤. 
Fastlaneì€ ì•Œë©´ ì•Œìˆ˜ë¡ ì¬ë°Œê³  ì‹ ê¸°í•˜ê³  ì¢‹ì€ ê¸°ëŠ¥ë„ ë§ë‹¤. 
ì¢€ ë” ê³µë¶€í•œë‹¤ë©´ ì—…ë¬´ íš¨ìœ¨ì„±ì„ íš¨ê³¼ì ìœ¼ë¡œ ë†’ì¼ ìˆ˜ ìˆì„ ê²ƒìœ¼ë¡œ ê¸°ëŒ€í•œë‹¤. 
ë‹¤ë“¤ ì¸„ë¼ì´ ì¸„ë¼ì´í•´ë³´ì‹œê¸¸!

í˜¹ì‹œ í‹€ë¦° ì ì´ ìˆë‹¤ë©´ ëŒ“ê¸€ë¡œ ì•Œë ¤ì£¼ì‹œë©´ ì •ë§ ê°ì‚¬í•˜ê² ìŠµë‹ˆë‹¤.ğŸ˜„